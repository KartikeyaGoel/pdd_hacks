// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// User model - stores user profile and authentication data
model User {
  id        String    @id @default(uuid())
  email     String    @unique
  name      String?
  profile   Json?     // User profile data
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  // Relations
  conversations Conversation[]
  documents     Document[]

  @@index([email])
  @@index([createdAt])
  @@map("users")
}

/// Conversation model - stores AI conversation sessions
model Conversation {
  id        String    @id @default(uuid())
  userId    String
  title     String?
  summary   String?   @db.Text
  startedAt DateTime  @default(now())
  endedAt   DateTime?
  duration  Int?      // Duration in seconds
  deletedAt DateTime?

  // Relations
  user     User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages ConversationMessage[]

  @@index([userId])
  @@index([startedAt])
  @@index([userId, startedAt])
  @@map("conversations")
}

/// ConversationMessage model - individual messages within a conversation
model ConversationMessage {
  id             String   @id @default(uuid())
  conversationId String
  role           String   // 'user', 'assistant', 'system'
  content        String   @db.Text
  timestamp      DateTime @default(now())

  // Relations
  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([conversationId, timestamp])
  @@map("conversation_messages")
}

/// Document model - stores uploaded learning materials
model Document {
  id              String    @id @default(uuid())
  userId          String
  name            String
  category        String?   // Document category (math, science, etc.)
  contentType     String    // MIME type
  uploadedAt      DateTime  @default(now())
  elevenLabsDocId String?   @unique // ElevenLabs Knowledge Base document ID
  deletedAt       DateTime?

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, uploadedAt])
  @@index([elevenLabsDocId])
  @@map("documents")
}
